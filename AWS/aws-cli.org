#+Title: AWS Cli
#+Subtitle:

* Instalacao
  https://docs.aws.amazon.com/pt_br/cli/latest/userguide/cli-chap-install.html

  Primeiro, confira a versao mais recente do aws-cli em
  https://github.com/aws/aws-cli/releases
  
  No momento da escrita desse texto a versão mais recente era a
 1.17.5
  
  
   #+NAME:  pip3 install awscli --upgrade --user                   
   #+BEGIN_SRC shell :session s1 :results output :exports code
      pip3 install awscli --upgrade --user
   #+END_SRC

   #+RESULTS: pip3 install awscli --upgrade --user
   #+begin_example
   Requirement already up-to-date: awscli in /home/wagner/.local/lib/python3.7/site-packages (1.17.5)
   =3.10 in /usr/lib64/python3.7/site-packages (from awscli) (5.1)
   Requirement already satisfied, skipping upgrade: botocore==1.14.5 in /home/wagner/.local/lib/python3.7/site-packages (from awscli) (1.14.5)
   =0.2.5 in /home/wagner/.local/lib/python3.7/site-packages (from awscli) (0.4.1)
   =3.1.2 in /home/wagner/.local/lib/python3.7/site-packages (from awscli) (3.4.2)
   =0.10 in /usr/lib/python3.7/site-packages (from awscli) (0.14)
   =0.3.0 in /home/wagner/.local/lib/python3.7/site-packages (from awscli) (0.3.1)
   =2.1 in /usr/lib/python3.7/site-packages (from botocore==1.14.5->awscli) (2.7.5)
   =0.7.1 in /home/wagner/.local/lib/python3.7/site-packages (from botocore==1.14.5->awscli) (0.9.4)
   =1.20 in /usr/lib/python3.7/site-packages (from botocore==1.14.5->awscli) (1.24.3)
   =0.1.3 in /usr/lib/python3.7/site-packages (from rsa<=3.5.0,>=3.1.2->awscli) (0.3.7)
   =1.5 in /usr/lib/python3.7/site-packages (from python-dateutil<3.0.0,>=2.1->botocore==1.14.5->awscli) (1.11.0)
   #+end_example

   
   #+NAME:  aws --version                   
   #+BEGIN_SRC shell :session s1 :results output :exports both
      #starts code
      aws --version
   #+END_SRC

   #+RESULTS: aws --version
   : 
   : aws-cli/1.17.5 Python/3.7.5 Linux/5.3.11-100.fc29.x86_64 botocore/1.14.5


   
   #+NAME:  pip3 list -o                   
   #+BEGIN_SRC shell :session s1 :results output :exports both
      #starts code
      pip3 list -o
   #+END_SRC

   #+RESULTS: pip3 list -o
   #+begin_example

   Package                  Version           Latest      Type 
   ------------------------ ----------------- ----------- -----
   alabaster                0.7.11            0.7.12      wheel
   alembic                  1.0.10            1.2.1       sdist
   argcomplete              1.9.5             1.10.0      wheel
   argh                     0.26.1            0.26.2      wheel
   asn1crypto               0.24.0            1.1.0       wheel
   attrs                    18.2.0            19.2.0      wheel
   Babel                    2.6.0             2.7.0       wheel
   bcrypt                   3.1.4             3.1.7       wheel
   Beaker                   1.10.0            1.11.0      sdist
   beautifulsoup4           4.6.3             4.8.1       wheel
   bleach                   2.1.4             3.1.0       wheel
   CairoSVG                 1.0.20            2.4.2       wheel
   cffi                     1.11.5            1.12.3      wheel
   click                    6.7               7.0         wheel
   coverage                 4.5.1             4.5.4       wheel
   cryptography             2.3               2.7         wheel
   cson                     0.7               0.8         wheel
   cssselect                0.9.2             1.1.0       wheel
   decorator                4.3.0             4.4.0       wheel
   defusedxml               0.5.0             0.6.0       wheel
   distro                   1.3.0             1.4.0       wheel
   docker                   3.5.0             4.1.0       wheel
   docker-compose           1.22.0            1.24.1      wheel
   docker-pycreds           0.3.0             0.4.0       wheel
   docutils                 0.14              0.15.2      wheel
   elpy                     1.28.0            1.999       wheel
   entrypoints              0.2.3             0.3         wheel
   fastcache                1.0.2             1.1.0       sdist
   flake8                   3.5.0             3.7.8       wheel
   Flask                    1.0.2             1.1.1       wheel
   Flask-SQLAlchemy         2.3.2             2.4.1       wheel
   future                   0.16.0            0.18.0      sdist
   GDAL                     2.3.2             3.0.1       sdist
   hyperlink                18.0.0            19.0.0      wheel
   idna                     2.7               2.8         wheel
   imagesize                1.0.0             1.1.0       wheel
   IPy                      0.81              1.0         sdist
   ipykernel                4.8.2             5.1.2       wheel
   ipython                  6.4.0             7.8.0       wheel
   ipython-genutils         0.1.0             0.2.0       wheel
   itsdangerous             0.24              1.1.0       wheel
   jedi                     0.12.1            0.15.1      wheel
   Jinja2                   2.10.1            2.10.3      wheel
   jsonschema               2.6.0             3.1.1       wheel
   jupyter-client           5.2.3             5.3.4       wheel
   jupyter-core             4.4.0             4.6.0       wheel
   langtable                0.0.41            0.0.47      wheel
   lxml                     4.2.5             4.4.1       wheel
   Mako                     1.1.0.dev0        1.1.0       sdist
   Markdown                 2.6.11            3.1.1       wheel
   MarkupSafe               1.0               1.1.1       wheel
   matplotlib               2.2.4             3.1.1       wheel
   mistune                  0.8.3             0.8.4       wheel
   mock                     2.0.0             3.0.5       wheel
   mod-wsgi                 4.6.4             4.6.8       sdist
   mpmath                   1.0.0             1.1.0       sdist
   nbconvert                5.3.1             5.6.0       wheel
   netifaces                0.10.6            0.10.9      sdist
   notebook                 5.7.8             6.0.1       wheel
   numexpr                  2.6.6             2.7.0       wheel
   numpy                    1.15.1            1.17.2      wheel
   ordered-set              2.0.2             3.1.1       sdist
   OWSLib                   0.17.0            0.18.0      sdist
   packaging                19.0              19.2        wheel
   pandas                   0.23.4            0.25.1      wheel
   pandas-datareader        0.6.0             0.8.1       wheel
   pandocfilters            1.4.1             1.4.2       sdist
   paramiko                 2.4.2             2.6.0       wheel
   parso                    0.3.1             0.5.1       wheel
   Paste                    2.0.3             3.2.1       wheel
   pbr                      4.1.1             5.4.3       wheel
   pexpect                  4.6.0             4.7.0       wheel
   pickleshare              0.7.4             0.7.5       wheel
   pid                      2.2.3             2.2.5       wheel
   Pillow                   5.3.0             6.2.0       wheel
   pip                      18.1              19.2.3      wheel
   ply                      3.9               3.11        wheel
   prometheus-client        0.6.0             0.7.1       sdist
   prompt-toolkit           1.0.16            2.0.10      wheel
   psutil                   5.4.3             5.6.3       sdist
   pyasn1                   0.3.7             0.4.7       wheel
   pyasn1-modules           0.1.5             0.2.7       wheel
   pycairo                  1.17.1            1.18.1      sdist
   pycodestyle              2.4.0             2.5.0       wheel
   pycparser                2.14              2.19        sdist
   pycups                   1.9.72            1.9.74      sdist
   pycurl                   7.43.0.2          7.43.0.3    sdist
   pydot                    1.0.29            1.4.1       wheel
   pyflakes                 2.0.0             2.1.1       wheel
   pyglet                   1.3.2             1.4.5       wheel
   Pygments                 2.2.0             2.4.2       wheel
   PyGObject                3.30.5            3.34.0      sdist
   pykickstart              3.16              3.20        sdist
   PyNaCl                   1.2.1             1.3.0       wheel
   pyparsing                2.2.0             2.4.2       wheel
   pyparted                 3.11.0            3.11.2      sdist
   pyproj                   1.9.5.1           2.4.0       wheel
   PyQt5                    5.11.3            5.13.1      wheel
   PyQt5-sip                4.19.13           12.7.0      wheel
   PySocks                  1.6.8             1.7.1       wheel
   pystray                  0.14.3            0.14.4      wheel
   python-augeas            0.5.0             1.0.3       sdist
   python-dateutil          2.7.5             2.8.0       wheel
   python-editor            1.0.3             1.0.4       wheel
   python-xlib              0.23              0.25        wheel
   pytoml                   0.1.18            0.1.21      wheel
   pytz                     2018.5            2019.3      wheel
   PyYAML                   5.1               5.1.2       sdist
   pyzmq                    17.0.0            18.1.0      wheel
   qutepart                 3.1.0             3.2.0.post2 sdist
   requests                 2.20.0            2.22.0      wheel
   rope                     0.11.0            0.14.0      wheel
   rsa                      3.4.2             4.0         wheel
   scipy                    1.1.0             1.3.1       wheel
   Send2Trash               1.4.2             1.5.0       wheel
   setuptools               40.8.0            41.4.0      wheel
   sip                      4.19.13           5.0.0       wheel
   six                      1.11.0            1.12.0      wheel
   slip                     0.6.4             20171205    wheel
   snowballstemmer          1.2.1             2.0.0       wheel
   Sphinx                   1.7.6             2.2.0       wheel
   sphinx-rtd-theme         0.4.2             0.4.3       wheel
   sphinxcontrib-websupport 1.1.0.dev20180715 1.1.2       wheel
   SQLAlchemy               1.2.19            1.3.10      sdist
   sympy                    1.2               1.4         wheel
   tables                   3.4.4             3.5.2       wheel
   Tempita                  0.5.1             0.5.2       sdist
   terminado                0.8.1             0.8.2       wheel
   testpath                 0.3.1             0.4.2       wheel
   texttable                1.4.0             1.6.2       sdist
   Theano                   1.0.2             1.0.4       sdist
   tornado                  5.0.2             6.0.3       sdist
   traitlets                4.3.2             4.3.3       wheel
   Twisted                  18.9.0            19.7.0      wheel
   urllib3                  1.24.3            1.25.6      wheel
   websocket-client         0.53.0            0.56.0      wheel
   Werkzeug                 0.14.1            0.16.0      wheel
   xlrd                     1.0.0             1.2.0       wheel
   xlwt                     1.1.2             1.3.0       wheel
   youtube-dl               2019.9.12.1       2019.9.28   wheel
   zope.event               4.2.0             4.4         wheel
   zope.interface           4.5.0             4.6.0       wheel
   #+end_example


* Configurando AWS CLI   
  https://docs.aws.amazon.com/pt_br/cli/latest/userguide/cli-chap-configure.html

  Antes de utilizar aws cli, que vc acabou de instalar, tem que
  configurar ela pra sua conta.

  Pra fazer a configuracao vc vai digitar o seguinte comando aws
  configure, mas nao digite agora porque ele vai pedir algumas
  informacoes pra vc que e  melhor vc conseguir as informacoes antes...
  
  Por exemplo, se vc tivesse digitado agora aws config a primeira
  pergunta da configuraco seria sua AWS Access Key ID. Entao, ja que
  a gente sabe que vamos precisar dela, vamos ja cria-la.

  Detalhe, se vc nao criou ainda um usuario do IAM pra vc usar, em
  substituicao ao seu usuario raiz, entao pare esse tutorial e faca
  isso, depois volte aqui...
  
  Mas se vc criou, entao vamos la..
  
  #+BEGIN_EXAMPLE
  [wagner@localhost ~]$ aws configure
  AWS Access Key ID [None]: 
  #+END_EXAMPLE

  As informacoes q vc tera que fornecer sao as seguintes...
  #+BEGIN_EXAMPLE
  AWS Access Key ID [None]:
  AWS Secret Access Key [None]: 
  Default region name [None]:
  Default output format [None]: 
  #+END_EXAMPLE

  Para "Default region name [None]:" vou usar: us-east-1 e para
  "Default output format [None]:" vou usar text porque acho que e mais
  tranquilo pra usar com bash.

  Apos o termino da configuracao do cliente aws sera criado um
  diretorio com os dados dessa configuracao nos seguintes locais

  Linux e MacOS: ~/.aws/config

  Windows: C:\Users\USERNAME\.aws\config 

  Caso vc tenha configurado o cliente para um usuario do IAM, nao o da
  conta raiz da aws, provavelmente vc queira tambem associar uma IAM
  Role para essa conta em relacao ao ECS. Para isso consulte https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-iam-roles.html
  
  Se vc tiver atras de um proxy, crie as seguintes variaveis de
  ambiente pro seu cliente aws passar por ele..

  #+BEGIN_EXAMPLE
  $ export HTTP_PROXY=http://username:password@proxy.example.com:1234
  $ export HTTPS_PROXY=http://username:password@proxy.example.com:5678
  #+END_EXAMPLE
  



* Entendendo webservices end points
  https://docs.aws.amazon.com/general/latest/gr/rande.html
  
  Os endpoinst que vc vai usar pra acessar os servicos da amazon sao
  referentes a regiao que vc escolheu pra utilizar.

  A sintaxe do endpoint e a seguinte

  protocol://service-code.region-code.amazonaws.com
  
  Como a gente escolheu a regiao us-east-1, pra acessar o servico de
  banco de dados dynamodb, a url do endpoint seria:

  #+BEGIN_EXAMPLE
  https://dynamodb.us-east-1.amazonaws.com
  #+END_EXAMPLE
  
  Para procurar por webservices e acessar a pagina da aws de cada um
  deles, para verificar quais sao suportados em relacao aos servicos da aws
  Sobre endpoints, bem como sua documentacao e qhotas, acesse a seguinte
  url https://docs.aws.amazon.com/general/latest/gr/aws-service-information.html

  Se vc estiver usando java, pra checar programaticamente dos servicos
  em relacao a regiao escolhida consulte esta url https://docs.aws.amazon.com/sdk-for-java/v2/developer-guide/java-dg-region-selection.html#region-selection-query-service


  
* A questao dos --profiles  
  Daria pra criar varias configuracoes de acesso
  A que a gente criou foi o Default

  Caso queira usar outro profile Ã© sÃ³ fazer conforme oriente o site da
  aws

  #+BEGIN_EXAMPLE
  #https://docs.aws.amazon.com/pt_br/cli/latest/userguide/cli-chap-configure.html
  $ aws configure --profile produser
  AWS Access Key ID [None]: AKIAI44QH8DHBEXAMPLE
  AWS Secret Access Key [None]: je7MtGbClwBF/2Zp9Utk/h3yCo8nvbEXAMPLEKEY
  Default region name [None]: us-east-1
  Default output format [None]: text
  aws s3 ls --profile produser
  #+END_EXAMPLE

  
* continuando
  
   #+NAME:  aws s3 ls                   
   #+BEGIN_SRC shell :session s1 :results output :exports both
      #starts code
      aws s3 ls
   #+END_SRC

   #+RESULTS: aws s3 ls
   : 
   : An error occurred (NotSignedUp) when calling the ListBuckets operation: Your account is not signed up for the S3 service. You must sign up before you can use S3.


* confirmacao da conta por email
  https://console.aws.amazon.com/organizations/home#/accounts?context=2432252BF60B64742C6513C7E00CF77180655225244E87570A80C2B85391AE8B
  
  Eu tinha tomado esse erro, 

  "An error occurred (NotSignedUp) when calling the ListBuckets
  operation: Your account is not signed up for the S3 service. You
  must sign up before you can use S3"

  Entrei no site da aws criei uma organizacao
  
  Apos confirmar por email a conta, criei uma organizacao e o erro
  sumiu, mas nao teve nenhuma saida...

   #+NAME:                     
   #+BEGIN_SRC shell :session s1 :results output :exports both
      #starts code
      aws s3 ls
   #+END_SRC

   #+RESULTS: 
  

* Criando um bucket
  Se vc tomou esse erro ao usar aws s3 ls


  EntÃ£o siga a documentaÃ§Ã£o nessa url
  https://docs.aws.amazon.com/pt_br/AmazonS3/latest/gsg/CreatingABucket.html,
  conforme vamos fazer abaixo

  Entre em

  https://docs.aws.amazon.com/pt_br/AmazonS3/latest/gsg/CreatingABucket.html
  
  https://console.aws.amazon.com/s3/home?region=us-east-1
  
  Qdo criar o bucket pode bloquear todos os acessos pÃºblicos
  
  Depois consulte abaixo como dar acessos 

  https://docs.aws.amazon.com/pt_br/AmazonS3/latest/user-guide/block-public-access.html

  
  
  


* refs
  https://www.thegeekstuff.com/2019/03/aws-configure-examples/
  https://www.thegeekstuff.com/2019/04/aws-s3-cli-examples/
  https://docs.aws.amazon.com/pt_br/cli/latest/index.html
